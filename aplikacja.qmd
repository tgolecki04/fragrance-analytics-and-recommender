---
title: "Aplikacja"
author: ""
format: html
editor: visual
number-sections: false
---

## Fragrance Recommender

<div>

```{=html}
<div class="form-wrapper">
  <form class="grid-form" id="myForm">

    <div class="select-box">
      <div class="select-card">
        <img
          src="images//article//aplikacja_formularz.jpg"
          alt="Opcja 1"
          class="perfume-img"
          >
        <input
          class="autocomplete"
          type="text"
          placeholder="Wybierz perfumy"
          autocomplete="off"
          id="input_1">
        <ul class="options">
        </ul>
      </div>
    </div>

    <div class="select-box">
      <div class="select-card">
        <img src="images//article//aplikacja_formularz_2.jpg" alt="Opcja 2">
        <input
          class="autocomplete"
          type="text"
          placeholder="Wybierz perfumy"
          autocomplete="off"
          id="input_2">
        <ul class="options">
        </ul>
      </div>
    </div>

    <div class="select-box">
      <div class="select-card">
        <img src="images//article//aplikacja_formularz_3.jpg" alt="Opcja 3">
        <input
          class="autocomplete"
          type="text"
          placeholder="Wybierz perfumy"
          autocomplete="off"
          id="input_3">
        <ul class="options"
        </ul>
      </div>
    </div>

    <div class="select-box">
      <div class="select-card">
        <img src="images//article//tlo.jpg" alt="Opcja 4">
        <input
          class="autocomplete"
          type="text"
          placeholder="Wybierz perfumy"
          autocomplete="off"
          id="input_4">
        <ul class="options">
        </ul>
      </div>
    </div>

     <div class="select-box">
      <div class="select-card">
        <img src="images//article//aplikacja_formularz_5.jpg" alt="Opcja 5">
        <input
          class="autocomplete"
          type="text"
          placeholder="Wybierz perfumy"
          autocomplete="off"
          id="input_5">
        <ul class="options">
        </ul>
      </div>
    </div>

     <div class="select-box">
      <div class="select-card">
        <img src="images//article//aplikacja_formularz_6.jpg" alt="Opcja 6">
        <input
          class="autocomplete"
          type="text"
          placeholder="Wybierz perfumy"
          autocomplete="off"
          id="input_6">
        <ul class="options">
        </ul>
      </div>
    </div>
    <div class="submit-wrapper">
      <button type="button" id="sendBtn">Sprawd≈∫</button>
    </div>
  </form>
  <div id="formMessage">Wynik modelu:</div>
</div>

<script>

/* ZAAWANOSOWANE AUTOUZUPELNIANIE Z DB */
document.addEventListener("DOMContentLoaded", () => {

  const AUTOCOMPLETE_URL = "http://localhost:3000/autocomplete";
  const PLACEHOLDER_IMG = "images/article/aplikacja_formularz.jpg";

  document.querySelectorAll(".select-box").forEach(box => {

    const input = box.querySelector(".autocomplete");
    const options = box.querySelector(".options");
    const image = box.querySelector("img");

    let controller = null;

    input.addEventListener("input", async () => {
      const query = input.value.trim();

      if (query.length < 2) {
        options.innerHTML = "";
        options.classList.remove("active");
        return;
      }

      // przerwij poprzednie zapytanie
      if (controller) controller.abort();
      controller = new AbortController();

      try {
        const res = await fetch(
          `${AUTOCOMPLETE_URL}?q=${encodeURIComponent(query)}`,
          { signal: controller.signal }
        );

        const data = await res.json();

        options.innerHTML = "";
        options.classList.add("active");

        data.forEach(item => {
          const li = document.createElement("li");
          li.textContent = item.Perfume;

          li.addEventListener("click", () => {
            input.value = item.Perfume;
            image.src = item.address_img || PLACEHOLDER_IMG;
            options.classList.remove("active");
          });

          options.appendChild(li);
        });

      } catch (err) {
        if (err.name !== "AbortError") {
          console.error("Autocomplete error:", err);
        }
      }
    });

    // klik poza pole ‚Üí zamknij dropdown
    document.addEventListener("click", e => {
      if (!box.contains(e.target)) {
        options.classList.remove("active");
      }
    });

  });

  // üîπ przycisk "Sprawd≈∫"
  document.getElementById("sendBtn").addEventListener("click", () => {
    const values = [];

    document.querySelectorAll(".autocomplete").forEach(input => {
      values.push(input.value.trim());
    });

    console.log("Wybrane perfumy:", values);

    // tu w przysz≈Ço≈õci:
    // fetch do backendu / model ML / Python
    document.getElementById("formMessage").textContent =
      "Wynik modelu: " + values.filter(v => v).join(", ");
  });

});


// Uruchomienie przycisku & zapis do bazy danych wprowadoznych informajci
document.getElementById("sendBtn").addEventListener("click", async () => {

  const data = {
    input_1: document.getElementById("input_1").value,
    input_2: document.getElementById("input_2").value,
    input_3: document.getElementById("input_3").value,
    input_4: document.getElementById("input_4").value,
    input_5: document.getElementById("input_5").value,
    input_6: document.getElementById("input_6").value
  };

  console.log("Wysy≈Çam:", data); // üîç DEBUG

  const response = await fetch("http://localhost:3000/save", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  });

  alert(await response.text());
  
  const response_python = await fetch("http://localhost:3000/random");
  const value = await response_python.text();
  document.getElementById("formMessage").textContent = "Najlepszy wyb√≥r: " + value;
});
</script>
```

</div>
