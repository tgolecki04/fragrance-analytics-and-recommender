---
title: "data_clean"
format: html
editor: visual
---

## Załadowanie danych

```{r}
library(kableExtra)
library(tidyverse)
library(dplyr)

dane <- read.csv2("fra_cleaned.csv") %>%
  mutate(
    across(c(Rating.Value, Rating.Count, Year), as.numeric),
    across(starts_with("mainaccord"), ~ na_if(.x, ""))
  ) %>%
  select(-Perfumer1, -Perfumer2) |> 
  na.omit() |> 
  rename(
    rating_value = 'Rating.Value',
    rating_count = 'Rating.Count'
  ) |> 
  mutate(rating_value = rating_count / (rating_count + 200) * rating_value + 200 / (rating_count + 200) * mean(rating_value))

# Tworzenie kolumny z adresami zdjęć
https_base <- "https://fimgs.net/mdimg/perfume-thumbs/375x500."

dane$address_img <- sapply(dane$url, function(u) {
  sub(".*-(\\d+)\\.html$", "\\1", u)
})


# tworzymy pełny URL obrazka
dane$address_img <- paste0(https_base, dane$address_img, ".2x.avif")



men_fragrances <- dane |> 
  subset(Gender == "men") |> 
  arrange(-rating_value)     # sortowanie po Rating.Count rosnąco
  

women_fragrances <- dane |> 
  subset(Gender == "women") |> 
  arrange(-rating_value) 

unisex_fragrances <- dane |> 
  subset(Gender == "unisex") |> 
  arrange(-rating_value) 

write.table(
  men_fragrances,
  "men_fragrances.csv",
  sep = ";",
  row.names = FALSE,
  col.names = TRUE,
  quote = FALSE
)

write.table(
  women_fragrances,
  "women_fragrances.csv",
  sep = ";",
  row.names = FALSE,
  col.names = TRUE,
  quote = FALSE
)

write.table(
  unisex_fragrances,
  "unisex_fragrances.csv",
  sep = ";",
  row.names = FALSE,
  col.names = TRUE,
  quote = FALSE
)


```
